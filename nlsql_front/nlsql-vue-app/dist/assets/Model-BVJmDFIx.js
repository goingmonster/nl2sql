import{_ as le,f as ae,c as P,a as y,b as l,w as o,g as te,h as oe,i as ne,E as s,j as m,r,k as re,m as ue,o as A,u as se,p as ie,n as i,t as k,v as T}from"./index-CPm_9BR3.js";import{g as de,d as pe,e as me,a as ge,b as ce,u as _e,c as fe}from"./llmConfig-D4kKmIJP.js";import"./index-DefhRm7t.js";const ve={class:"model-view"},be={class:"card"},ye={class:"table-header"},ke={class:"card"},we={class:"pagination-wrapper"},Ve={key:0,class:"batch-actions"},Ce={__name:"Model",setup(xe){const x=m(!1),h=m(!1),f=m(!1),v=m(!1),w=m(""),z=m([]),b=m([]),V=m(),u=ue({page:1,pageSize:20,total:0}),n=m({provider:"",model_name:"",base_url:"",api_key:"",max_tokens:4096,temperature:.7,status:1,description:""}),q={provider:[{required:!0,message:"请选择供应商",trigger:"change"}],model_name:[{required:!0,message:"请输入模型名称",trigger:"blur"},{min:1,max:100,message:"模型名称长度应在 1-100 个字符之间",trigger:"blur"}],base_url:[{required:!0,message:"请输入 API 地址",trigger:"blur"},{type:"url",message:"请输入正确的 URL 格式",trigger:"blur"}],api_key:[{required:!0,message:"请输入 API 密钥",trigger:"blur"}],max_tokens:[{required:!0,message:"请输入最大 Token 数",trigger:"blur"},{type:"number",min:1,max:1e5,message:"Token 数范围应在 1-100000 之间",trigger:"blur"}],temperature:[{required:!0,message:"请输入温度参数",trigger:"blur"},{type:"number",min:0,max:2,message:"温度参数应在 0-2 之间",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]};async function g(){try{x.value=!0;const a={page:u.page,page_size:u.pageSize};w.value&&(a.provider=w.value);const e=await de(a);z.value=e.data||[],u.total=e.pagination?.total||0}catch(a){console.error("获取模型配置列表失败:",a),s.error("获取模型配置列表失败")}finally{x.value=!1}}function E(){u.page=1,g()}function $(a){b.value=a}function M(a){u.pageSize=a,u.page=1,g()}function N(a){u.page=a,g()}function L(){n.value={provider:"",model_name:"",base_url:"",api_key:"",max_tokens:4096,temperature:.7,status:1,description:""},v.value=!1,V.value?.clearValidate()}function O(a){v.value=!0,n.value={id:a.id,provider:a.provider,model_name:a.model_name,base_url:a.base_url,api_key:a.api_key,max_tokens:a.max_tokens,temperature:a.temperature,status:a.status,description:a.description},f.value=!0}async function R(a){try{await T.confirm(`确定要删除模型配置 ${a.provider} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ge(a.id),s.success("删除成功"),g()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),s.error("删除失败"))}}async function j(){if(b.value.length===0){s.warning("请选择要删除的记录");return}try{await T.confirm(`确定要删除选中的 ${b.value.length} 条记录吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=b.value.map(e=>e.id);await ce(a),s.success("批量删除成功"),g()}catch(a){a!=="cancel"&&(console.error("批量删除失败:",a),s.error("批量删除失败"))}}async function F(a){try{a.status===1?(await pe(a.id),s.success("禁用成功")):(await me(a.id),s.success("启用成功")),g()}catch(e){console.error("状态切换失败:",e),s.error("状态切换失败")}}async function G(){if(V.value)try{await V.value.validate(),h.value=!0;const a={...n.value};delete a.id,v.value?(await _e(n.value.id,a),s.success("更新成功")):(await fe(a),s.success("添加成功")),f.value=!1,L(),g()}catch(a){console.error(v.value?"更新失败:":"添加失败:",a),s.error(v.value?"更新失败":"添加失败")}finally{h.value=!1}}function H(a){return a?new Date(a).toLocaleString("zh-CN"):"-"}function J(){L()}return ae(()=>{g()}),(a,e)=>{const d=r("el-option"),I=r("el-select"),K=r("el-icon"),_=r("el-button"),p=r("el-table-column"),S=r("el-tag"),Q=r("el-table"),W=r("el-pagination"),c=r("el-form-item"),C=r("el-input"),U=r("el-input-number"),B=r("el-radio"),X=r("el-radio-group"),Y=r("el-form"),Z=r("el-dialog"),ee=re("loading");return A(),P("div",ve,[y("div",be,[e[15]||(e[15]=y("h2",{class:"card-title"},"模型管理",-1)),e[16]||(e[16]=y("p",{class:"page-desc"},"管理LLM配置，支持多种提供商，仅支持OPENAI",-1)),y("div",ye,[l(I,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),placeholder:"筛选供应商",clearable:"",onChange:E,style:{width:"150px","margin-right":"20px"}},{default:o(()=>[l(d,{label:"OpenAI",value:"OpenAI"}),l(d,{label:"Azure",value:"Azure"}),l(d,{label:"Anthropic",value:"Anthropic"}),l(d,{label:"百度",value:"Baidu"}),l(d,{label:"阿里云",value:"Aliyun"})]),_:1},8,["modelValue"]),l(_,{type:"primary",class:"btn-gradient",onClick:e[1]||(e[1]=t=>f.value=!0)},{default:o(()=>[l(K,null,{default:o(()=>[l(se(ie))]),_:1}),e[14]||(e[14]=i(" 添加模型 ",-1))]),_:1})])]),y("div",ke,[te((A(),oe(Q,{data:z.value,style:{width:"100%"},onSelectionChange:$},{default:o(()=>[l(p,{type:"selection",width:"55"}),l(p,{prop:"provider",label:"供应商",width:"150"},{default:o(t=>[l(S,null,{default:o(()=>[i(k(t.row.provider),1)]),_:2},1024)]),_:1}),l(p,{prop:"model_name",label:"模型名称",width:"180"}),l(p,{prop:"base_url",label:"API地址","min-width":"250"}),l(p,{prop:"description",label:"描述"}),l(p,{prop:"max_tokens",label:"最大Token",width:"120"}),l(p,{prop:"temperature",label:"温度",width:"80"}),l(p,{prop:"status",label:"状态",width:"100"},{default:o(t=>[l(S,{type:t.row.status===1?"success":"danger"},{default:o(()=>[i(k(t.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"created_at",label:"创建时间",width:"180"},{default:o(t=>[i(k(H(t.row.created_at)),1)]),_:1}),l(p,{label:"操作",width:"200",fixed:"right"},{default:o(t=>[l(_,{link:"",type:"primary",onClick:D=>O(t.row)},{default:o(()=>[...e[17]||(e[17]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(_,{link:"",type:t.row.status===1?"warning":"success",onClick:D=>F(t.row)},{default:o(()=>[i(k(t.row.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(_,{link:"",type:"danger",onClick:D=>R(t.row)},{default:o(()=>[...e[18]||(e[18]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,x.value]]),y("div",we,[l(W,{"current-page":u.page,"onUpdate:currentPage":e[2]||(e[2]=t=>u.page=t),"page-size":u.pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>u.pageSize=t),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:N},null,8,["current-page","page-size","total"])]),b.value.length>0?(A(),P("div",Ve,[l(_,{type:"danger",onClick:j},{default:o(()=>[i(" 删除选中的 "+k(b.value.length)+" 条记录 ",1)]),_:1})])):ne("",!0)]),l(Z,{modelValue:f.value,"onUpdate:modelValue":e[13]||(e[13]=t=>f.value=t),title:v.value?"编辑模型配置":"添加模型配置",width:"600px",onClose:J},{footer:o(()=>[l(_,{onClick:e[12]||(e[12]=t=>f.value=!1)},{default:o(()=>[...e[21]||(e[21]=[i("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:G,loading:h.value},{default:o(()=>[...e[22]||(e[22]=[i(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(Y,{ref_key:"formRef",ref:V,model:n.value,rules:q,"label-width":"120px"},{default:o(()=>[l(c,{label:"供应商",prop:"provider"},{default:o(()=>[l(I,{modelValue:n.value.provider,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.provider=t),placeholder:"选择供应商",style:{width:"100%"}},{default:o(()=>[l(d,{label:"OpenAI",value:"OpenAI"}),l(d,{label:"Azure",value:"Azure"}),l(d,{label:"Anthropic",value:"Anthropic"}),l(d,{label:"百度",value:"Baidu"}),l(d,{label:"阿里云",value:"Aliyun"})]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"模型名称",prop:"model_name"},{default:o(()=>[l(C,{modelValue:n.value.model_name,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.model_name=t),placeholder:"请输入模型名称，如：gpt-3.5-turbo"},null,8,["modelValue"])]),_:1}),l(c,{label:"API地址",prop:"base_url"},{default:o(()=>[l(C,{modelValue:n.value.base_url,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.base_url=t),placeholder:"请输入 API 地址"},null,8,["modelValue"])]),_:1}),l(c,{label:"API密钥",prop:"api_key"},{default:o(()=>[l(C,{modelValue:n.value.api_key,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.api_key=t),type:"password",placeholder:"请输入 API 密钥","show-password":""},null,8,["modelValue"])]),_:1}),l(c,{label:"最大Token",prop:"max_tokens"},{default:o(()=>[l(U,{modelValue:n.value.max_tokens,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.max_tokens=t),min:1,max:1e5,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"温度参数",prop:"temperature"},{default:o(()=>[l(U,{modelValue:n.value.temperature,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.temperature=t),min:0,max:2,step:.1,precision:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"状态",prop:"status"},{default:o(()=>[l(X,{modelValue:n.value.status,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.status=t)},{default:o(()=>[l(B,{label:1},{default:o(()=>[...e[19]||(e[19]=[i("启用",-1)])]),_:1}),l(B,{label:2},{default:o(()=>[...e[20]||(e[20]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"描述",prop:"description"},{default:o(()=>[l(C,{modelValue:n.value.description,"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.description=t),type:"textarea",rows:3,placeholder:"请输入描述信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Le=le(Ce,[["__scopeId","data-v-334ddc82"]]);export{Le as default};
