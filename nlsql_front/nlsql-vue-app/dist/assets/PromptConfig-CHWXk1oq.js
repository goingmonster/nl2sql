import{_ as de,f as pe,c as p,a as f,b as t,w as a,E as v,j as c,r,k as ce,o as d,u as D,p as $,n as s,g as fe,h as _e,t as y,F as w,x as N,i as L,v as me,m as ge}from"./index-CPm_9BR3.js";import{g as ve,d as ye,u as be,c as Ce}from"./promptConfig-DAy8NaTW.js";import"./index-DefhRm7t.js";const ke={class:"prompt-config-container"},Ve={class:"page-header"},he={class:"pagination-container"},xe={class:"preset-options",style:{"margin-top":"10px"}},ze={key:0,class:"notes-list",style:{"margin-top":"15px"}},we={class:"preset-options",style:{"margin-top":"10px"}},Ne={key:0,class:"notes-list",style:{"margin-top":"15px"}},Pe={class:"dialog-footer"},Te={__name:"PromptConfig",setup(Ue){const P=c(!1),T=c(!1),m=c(!1),g=c(null),b=c(null),C=c(1),k=c(20),B=c(0),S=c([]),o=ge({config_name:"",config_type:1,system_config:"",table_notes:[],field_notes:[]}),M={config_name:[{required:!0,message:"请输入配置名称",trigger:"blur"}],config_type:[{required:!0,message:"请选择配置类型",trigger:"change"}]},R=["可以用来查询...","可以用来统计分析","可以用来进行","简洁明了地描述表的用途","结合表特定信息（如果有）"],j=["字段名称和类型：明确说明字段的数据类型","字段描述和用途：用通俗易懂的语言解释","空值率和使用建议：给出具体数值和使用建议","样例数据：提供实际的数据样本","枚举值情况：如果是枚举字段且枚举少于10个，使用【】列出5个枚举值","是否需要简繁体转化：明确说明是否需要进行简繁体转换","是否需要数字汉字泛化查询：明确说明是否需要数字和汉字的泛化查询"],q=l=>({1:"",2:"success",3:"warning"})[l]||"",W=l=>({1:"默认",2:"自定义",3:"系统预制"})[l]||"未知",I=l=>l?new Date(l).toLocaleString("zh-CN"):"",V=async()=>{P.value=!0;try{const l=await ve({skip:(C.value-1)*k.value,limit:k.value});S.value=l.data||[],B.value=l.total||0}catch(l){v.error("获取配置列表失败："+l.message)}finally{P.value=!1}},A=l=>{C.value=l,V()},G=l=>{k.value=l,C.value=1,V()},H=()=>{o.table_notes.push("")},J=l=>{o.table_notes.push(l)},K=l=>{o.table_notes.splice(l,1)},O=()=>{o.field_notes.push("")},Q=l=>{o.field_notes.push(l)},X=l=>{o.field_notes.splice(l,1)},Y=l=>{g.value=l,o.config_name=l.config_name,o.config_type=l.config_type,o.system_config=l.system_config||"",o.table_notes=[...l.table_notes||[]],o.field_notes=[...l.field_notes||[]],m.value=!0},Z=l=>{me.confirm(`确定要删除配置"${l.config_name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ye(l.id),v.success("删除成功"),V()}catch(e){v.error("删除失败："+e.message)}})},ee=()=>{m.value=!1,g.value=null,E()},E=()=>{o.config_name="",o.config_type=1,o.system_config="",o.table_notes=[],o.field_notes=[],b.value&&b.value.clearValidate()},te=async()=>{if(b.value){try{await b.value.validate()}catch{return}T.value=!0;try{const l={config_name:o.config_name,config_type:o.config_type,system_config:o.system_config,table_notes:o.table_notes.filter(e=>e.trim()),field_notes:o.field_notes.filter(e=>e.trim())};g.value?(await be(g.value.id,l),v.success("更新配置成功")):(await Ce(l),v.success("创建配置成功")),m.value=!1,g.value=null,E(),V()}catch(l){v.error("保存失败："+l.message)}finally{T.value=!1}}};return pe(()=>{V()}),(l,e)=>{const U=r("el-icon"),u=r("el-button"),_=r("el-table-column"),le=r("el-tag"),oe=r("el-table"),ne=r("el-pagination"),ae=r("el-card"),z=r("el-input"),h=r("el-form-item"),F=r("el-option"),se=r("el-select"),ie=r("el-form"),re=r("el-dialog"),ue=ce("loading");return d(),p("div",ke,[f("div",Ve,[e[8]||(e[8]=f("h2",null,"提示词生成配置",-1)),t(u,{type:"primary",onClick:e[0]||(e[0]=n=>m.value=!0)},{default:a(()=>[t(U,null,{default:a(()=>[t(D($))]),_:1}),e[7]||(e[7]=s(" 新建配置 ",-1))]),_:1})]),t(ae,{class:"config-list"},{default:a(()=>[fe((d(),_e(oe,{data:S.value,style:{width:"100%"}},{default:a(()=>[t(_,{prop:"config_name",label:"配置名称",width:"200"}),t(_,{prop:"config_type",label:"配置类型",width:"120"},{default:a(({row:n})=>[t(le,{type:q(n.config_type)},{default:a(()=>[s(y(W(n.config_type)),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"system_config",label:"系统描述","show-overflow-tooltip":""}),t(_,{label:"表描述数量",width:"120"},{default:a(({row:n})=>[s(y(n.table_notes?n.table_notes.length:0),1)]),_:1}),t(_,{label:"字段描述数量",width:"120"},{default:a(({row:n})=>[s(y(n.field_notes?n.field_notes.length:0),1)]),_:1}),t(_,{prop:"updated_at",label:"更新时间",width:"180"},{default:a(({row:n})=>[s(y(I(n.updated_at)),1)]),_:1}),t(_,{label:"操作",width:"200",fixed:"right"},{default:a(({row:n})=>[t(u,{size:"small",onClick:i=>Y(n)},{default:a(()=>[...e[9]||(e[9]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"danger",onClick:i=>Z(n)},{default:a(()=>[...e[10]||(e[10]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,P.value]]),f("div",he,[t(ne,{"current-page":C.value,"onUpdate:currentPage":e[1]||(e[1]=n=>C.value=n),"page-size":k.value,"onUpdate:pageSize":e[2]||(e[2]=n=>k.value=n),total:B.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:A,onSizeChange:G},null,8,["current-page","page-size","total"])])]),_:1}),t(re,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=n=>m.value=n),title:g.value?"编辑配置":"新建配置",width:"80%",top:"5vh",class:"config-dialog"},{footer:a(()=>[f("span",Pe,[t(u,{onClick:ee},{default:a(()=>[...e[17]||(e[17]=[s("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:te,loading:T.value},{default:a(()=>[...e[18]||(e[18]=[s(" 保存 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(ie,{ref_key:"configFormRef",ref:b,model:o,rules:M,"label-width":"140px"},{default:a(()=>[t(h,{label:"配置名称",prop:"config_name"},{default:a(()=>[t(z,{modelValue:o.config_name,"onUpdate:modelValue":e[3]||(e[3]=n=>o.config_name=n),placeholder:"请输入配置名称"},null,8,["modelValue"])]),_:1}),t(h,{label:"配置类型",prop:"config_type"},{default:a(()=>[t(se,{modelValue:o.config_type,"onUpdate:modelValue":e[4]||(e[4]=n=>o.config_type=n),placeholder:"请选择配置类型"},{default:a(()=>[t(F,{label:"默认",value:1}),t(F,{label:"自定义",value:2}),t(F,{label:"系统预制",value:3})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"系统级别描述"},{default:a(()=>[t(z,{modelValue:o.system_config,"onUpdate:modelValue":e[5]||(e[5]=n=>o.system_config=n),type:"textarea",rows:3,placeholder:"请输入系统级别的描述"},null,8,["modelValue"])]),_:1}),t(h,{label:"表描述规则"},{default:a(()=>[t(u,{type:"primary",plain:"",onClick:H},{default:a(()=>[t(U,null,{default:a(()=>[t(D($))]),_:1}),e[11]||(e[11]=s(" 添加表描述 ",-1))]),_:1}),f("div",xe,[e[12]||(e[12]=f("span",{class:"preset-label"},"快速添加预设：",-1)),(d(),p(w,null,N(R,n=>t(u,{key:n,size:"small",plain:"",onClick:i=>J(n)},{default:a(()=>[s(y(n),1)]),_:2},1032,["onClick"])),64))]),o.table_notes.length>0?(d(),p("div",ze,[(d(!0),p(w,null,N(o.table_notes,(n,i)=>(d(),p("div",{key:i,class:"note-item"},[t(z,{modelValue:o.table_notes[i],"onUpdate:modelValue":x=>o.table_notes[i]=x,placeholder:"请输入表描述规则",style:{"margin-bottom":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),t(u,{size:"small",type:"danger",plain:"",onClick:x=>K(i),style:{"margin-bottom":"10px"}},{default:a(()=>[...e[13]||(e[13]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]))),128))])):L("",!0)]),_:1}),t(h,{label:"字段描述规则"},{default:a(()=>[t(u,{type:"primary",plain:"",onClick:O},{default:a(()=>[t(U,null,{default:a(()=>[t(D($))]),_:1}),e[14]||(e[14]=s(" 添加字段描述 ",-1))]),_:1}),f("div",we,[e[15]||(e[15]=f("span",{class:"preset-label"},"快速添加预设：",-1)),(d(),p(w,null,N(j,n=>t(u,{key:n,size:"small",plain:"",onClick:i=>Q(n)},{default:a(()=>[s(y(n),1)]),_:2},1032,["onClick"])),64))]),o.field_notes.length>0?(d(),p("div",Ne,[(d(!0),p(w,null,N(o.field_notes,(n,i)=>(d(),p("div",{key:i,class:"note-item"},[t(z,{modelValue:o.field_notes[i],"onUpdate:modelValue":x=>o.field_notes[i]=x,placeholder:"请输入字段描述规则",style:{"margin-bottom":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),t(u,{size:"small",type:"danger",plain:"",onClick:x=>X(i),style:{"margin-bottom":"10px"}},{default:a(()=>[...e[16]||(e[16]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]))),128))])):L("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Be=de(Te,[["__scopeId","data-v-ac617d6a"]]);export{Be as default};
