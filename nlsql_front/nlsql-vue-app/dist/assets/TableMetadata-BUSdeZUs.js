import{_ as te,f as le,c as k,a as d,b as t,w as o,g as oe,h as U,t as c,E as f,j as u,r as s,k as ne,m as se,o as v,u as ie,s as re,F as de,x as ce,n as i,i as ue,v as O}from"./index-CPm_9BR3.js";import{g as pe,e as _e,f as fe,h as ge}from"./tableMetadata-BYn0U9Y9.js";import"./index-DefhRm7t.js";const me={class:"table-metadata-view"},be={class:"card"},ve={class:"search-section"},he={class:"card"},ye={class:"table-container"},we={class:"compact-pagination"},Ce={class:"pagination-content"},Te={class:"record-count"},De={key:0,class:"table-details"},Ve={style:{"margin-top":"20px"}},Le={__name:"TableMetadata",setup(ke){const T=u(!1),h=u(""),y=u(null),w=u(""),x=u([]),D=u([]),g=u([]),C=u(!1),r=u(null),n=se({page:1,pageSize:10,total:0});async function F(){try{const a=await pe({page:1,page_size:100});D.value=a.items||[]}catch(a){console.error("获取数据库配置列表失败:",a),f.error("获取数据库配置列表失败")}}async function p(){try{T.value=!0;const a={skip:(n.page-1)*n.pageSize,limit:n.pageSize};h.value&&(a.table_name=h.value),y.value&&(a.db_config_id=y.value),w.value&&(a.table_type=w.value),console.log("发送的参数:",a);const e=await _e(a);x.value=e.items||[],n.total=e.total||0}catch(a){console.error("获取表元数据列表失败:",a),f.error("获取表元数据列表失败")}finally{T.value=!1}}let V=null;function $(){V&&clearTimeout(V),V=setTimeout(()=>{n.page=1,p()},500)}function G(){n.page=1,p()}function W(){n.page=1,p()}function j(a){g.value=a}function K(a){n.pageSize=a,n.page=1,p()}function P(a){n.page=a,p()}function R(a){r.value=a,C.value=!0}async function q(a){try{await O.confirm(`确定要删除表 ${a.table_name} 的元数据吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ge(a.id),f.success("删除成功"),p()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),f.error("删除失败"))}}async function H(){if(g.value.length===0){f.warning("请选择要删除的记录");return}try{await O.confirm(`确定要删除选中的 ${g.value.length} 条记录吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=g.value.map(e=>e.id);await fe({ids:a}),f.success("批量删除成功"),p()}catch(a){a!=="cancel"&&(console.error("批量删除失败:",a),f.error("批量删除失败"))}}function z(a){const e=D.value.find(L=>L.id===a);return e?e.database_name:"未知数据库"}function S(a){return{TABLE:"primary",VIEW:"success",FACT:"warning",DIMENSION:"info",LOG:"danger"}[a]||"primary"}function B(a){return a?new Date(a).toLocaleString("zh-CN"):"-"}return le(()=>{F(),p()}),(a,e)=>{const L=s("el-icon"),E=s("el-input"),m=s("el-option"),I=s("el-select"),M=s("el-button"),_=s("el-table-column"),N=s("el-tag"),A=s("el-link"),J=s("el-divider"),Q=s("el-table"),X=s("el-pagination"),b=s("el-descriptions-item"),Y=s("el-descriptions"),Z=s("el-dialog"),ee=ne("loading");return v(),k("div",me,[d("div",be,[e[10]||(e[10]=d("h2",{class:"card-title"},"基础数据",-1)),e[11]||(e[11]=d("p",{class:"page-desc"},"管理数据库表的基础元数据信息，包括表结构、DDL等详细内容",-1)),d("div",ve,[t(E,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),placeholder:"搜索表名称",clearable:"",onInput:$,class:"search-input"},{prefix:o(()=>[t(L,null,{default:o(()=>[t(ie(re))]),_:1})]),_:1},8,["modelValue"]),t(I,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=l=>y.value=l),placeholder:"选择数据库",clearable:"",onChange:G,class:"db-select"},{default:o(()=>[(v(!0),k(de,null,ce(D.value,l=>(v(),U(m,{key:l.id,label:l.database_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(I,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),placeholder:"选择表类型",clearable:"",onChange:W,class:"type-select"},{default:o(()=>[t(m,{label:"TABLE",value:"TABLE"}),t(m,{label:"VIEW",value:"VIEW"}),t(m,{label:"FACT",value:"FACT"}),t(m,{label:"DIMENSION",value:"DIMENSION"}),t(m,{label:"LOG",value:"LOG"})]),_:1},8,["modelValue"]),t(M,{type:"danger",onClick:H,disabled:g.value.length===0,class:"batch-delete-btn"},{default:o(()=>[i(" 批量删除 ("+c(g.value.length)+") ",1)]),_:1},8,["disabled"])]),d("div",he,[d("div",ye,[oe((v(),U(Q,{data:x.value,style:{width:"100%"},onSelectionChange:j},{default:o(()=>[t(_,{type:"selection",width:"55"}),t(_,{prop:"id",label:"ID",width:"80"}),t(_,{prop:"table_name",label:"表名称","min-width":"180","show-overflow-tooltip":""}),t(_,{prop:"database_name",label:"数据库名称",width:"150"},{default:o(l=>[i(c(z(l.row.db_config_id)),1)]),_:1}),t(_,{prop:"table_type",label:"表类型",width:"100"},{default:o(l=>[t(N,{type:S(l.row.table_type)},{default:o(()=>[i(c(l.row.table_type||"TABLE"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"table_description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(_,{prop:"created_at",label:"创建时间",width:"180"},{default:o(l=>[i(c(B(l.row.created_at)),1)]),_:1}),t(_,{label:"操作",width:"120"},{default:o(l=>[t(A,{type:"primary",onClick:ae=>R(l.row)},{default:o(()=>[...e[8]||(e[8]=[i("查看",-1)])]),_:1},8,["onClick"]),t(J,{direction:"vertical"}),t(A,{type:"danger",onClick:ae=>q(l.row)},{default:o(()=>[...e[9]||(e[9]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,T.value]])])])]),d("div",we,[d("div",Ce,[d("span",Te,c(n.total),1),t(X,{"current-page":n.page,"onUpdate:currentPage":e[3]||(e[3]=l=>n.page=l),"page-size":n.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>n.pageSize=l),total:n.total,"page-sizes":[10,20,50,100],size:"small",layout:"prev, pager, next, sizes",onSizeChange:K,onCurrentChange:P,background:!1},null,8,["current-page","page-size","total"])])]),t(Z,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l),title:"基础数据详情",width:"800px"},{footer:o(()=>[t(M,{onClick:e[6]||(e[6]=l=>C.value=!1)},{default:o(()=>[...e[13]||(e[13]=[i("关闭",-1)])]),_:1})]),default:o(()=>[r.value?(v(),k("div",De,[t(Y,{column:2,border:""},{default:o(()=>[t(b,{label:"ID"},{default:o(()=>[i(c(r.value.id),1)]),_:1}),t(b,{label:"表名称"},{default:o(()=>[i(c(r.value.table_name),1)]),_:1}),t(b,{label:"数据库名称"},{default:o(()=>[i(c(z(r.value.db_config_id)),1)]),_:1}),t(b,{label:"表类型"},{default:o(()=>[t(N,{type:S(r.value.table_type)},{default:o(()=>[i(c(r.value.table_type||"TABLE"),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"创建时间",span:"2"},{default:o(()=>[i(c(B(r.value.created_at)),1)]),_:1}),t(b,{label:"表描述",span:"2"},{default:o(()=>[i(c(r.value.table_description||"暂无描述"),1)]),_:1})]),_:1}),d("div",Ve,[e[12]||(e[12]=d("h4",null,"DDL 语句：",-1)),t(E,{modelValue:r.value.table_ddl,"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.table_ddl=l),type:"textarea",rows:10,readonly:"",style:{"font-family":"monospace"}},null,8,["modelValue"])])])):ue("",!0)]),_:1},8,["modelValue"])])}}},Be=te(Le,[["__scopeId","data-v-56f2e0a0"]]);export{Be as default};
